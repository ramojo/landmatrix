{% load i18n %}

{% block before %}
{% endblock %}

<div class="row">
    <div class="span4">
        <div class="well-square">
            {% block description %}{{ body|safe }}{% endblock %}
        </div>
    </div>
    <div class="span4">
        <div class="well-square data-availability">
        	{% block data_availability %}
            <h5>Data availability <a href="/about/#what-does-data-availability-mean" class="toggle-tooltip" title="The infographics show information about deals for which relevant data is available in our dataset. The small pie chart below shows percentage of deals represented. Click to read more."><i class="icon icon-question-sign"> </i></a></h5>
            <a href="/get-the-detail/" class="pull-left">
                <canvas id="pie-availability" width="36" height="36"></canvas>
            </a>
            <ul class="media-list legend pull-left">
                <li style="color: #1e1e1e;">{% trans "Information" %}<span></span></li>
                <li style="color: #828282;">{% trans "No information" %}<span></span></li>
            </ul>
            <p style="clear:both">&nbsp;</p>
            {% endblock %}
            {% block legend %}
            <ul class="media-list legend offset">
                <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span> {% trans "Food-Crop - Crops that be consumed by humans, even if also used as livestock feed" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #225559;"></i><span> {% trans "Non-Food - Biofuels, exclusive livestock feed, industrial, cosmetic and medicinal uses" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span> {% trans "Flex-Crop - Potential both biofuel and food uses" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span> {% trans "Multiple Use - Several crops in different categories" %}</span></li>
            </ul>
            {% endblock %}
        </div>
    </div>
    <div class="span4">
        <div class="row">
            <div class="span4 filters">
            	{% block filters %}
                <div class="row">
                    <div class="btn-group span4 negotiation_status">
                      <button type="submit" class="btn active" name="negotiation_status" value="concluded">{% trans "Concluded deals" %}</button>
                      <button type="submit" class="btn" name="negotiation_status" value="intended">{% trans "Intended deals" %}</button>
                      <button type="submit" class="btn failed" name="negotiation_status" value="failed">{% trans "Failed deals" %}</button>
                      <a href="/about/#how-does-the-global-observatory-deal-with-different-stages-of-negotiation-and-implementation" class="toggle-tooltip left" title="The Land Matrix distinguishes between intended, concluded and failed deals. For further information press the question mark."><i class="icon icon-question-sign"> </i></a>
                    </div>
                </div>
                <div class="row">
                    <div class="btn-group span4 deal_scope form-inline">
                      <button type="submit" class="btn active" name="deal_scope" value="transnational">{% trans "Transnational deals" %}</button>
                      <button type="submit" class="btn" name="filter" value="domestic">{% trans "Domestic deals" %}</button>
                        <a href="/about/#are-there-biases-in-the-data" class="toggle-tooltip left" title="Please note that purely domestic deals are largely underrepresented in the Land Matrix. For further information press the question mark."><i class="icon icon-question-sign"> </i></a>
                    </div>
                </div>
                <div class="row">
                    <div class="btn-group span4 data_source_type">
                      <button type="submit" class="btn" name="data_source_type" value="exclude-media-reports">{% trans "Exclude media reports" %}</button>
                    </div>
                </div>
                {% endblock %}
            </div>
        </div>
    </div>
</div>

{% block data %}
{% endblock %}

{% block after %}
<script type="text/javascript">
function get_base_filter() {
    var filters = "";
    // negotiation status (concluded, intended, failed)
    $('.filters .negotiation_status:visible .btn.active').each(function() {
        filters += "&negotiation_status=" + $(this).val();
    });
	// deal scope (transnational, domestic)
    $('.filters .deal_scope .btn.active').each(function() {
        filters += "&deal_scope=" + $(this).val();
    });
	// data source (boolean)
    $('.filters .data_source_type .btn.active').each(function() {
        filters += "&data_source_type=1";
    });
    return filters.substr(1);
}
function get_query_params(base_filter, filter) {
    if (base_filter && filter) {
        return "?" + base_filter + "&" + filter;
    } else if (base_filter) {
        return "?" + base_filter;
    } else if (filter) {
        return "?" + filter;
    }
    return "";
}
function get_filter() {
    var filter = "";
    var element = $(".actions .action2 .btn.active");
    if (element.length != 0) {
        var params = getParameterByName($(element).attr("href").replace("?", ""));
        var filter = "";
        if (params["filter"] != undefined) {
            filter = "filter=" + params["filter"];
        }
    }
    return filter;
}
$(document).ready(function () {
    $(".filters .btn").click(function (e) {
        var c_self = $(this);
        c_self.button('loading');
        // only combine concluded and intended
        if (c_self.parent().is(".negotiation_status")) {
            if (c_self.val() == "failed") {
                c_self.parent().find(".btn[value=concluded],.btn[value=intended]").removeClass("active");
            } else {
                c_self.parent().find(".btn[value=failed]").removeClass("active");
            }
        }
        c_self.toggleClass("active");
        draw(function() {
            c_self.button('reset');
        });
        e.preventDefault();
    });
    $(".actions .action2 .btn.active").click();
});
</script>
{% endblock %}
