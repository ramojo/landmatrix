{% extends "base.html" %}
{% load i18n custom_tags %}
{% load humanize %}

{% block head %}

  {# bootstrap #}
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <style type="text/css">
    .bs-example{
    	margin: 20px;
    }
  </style>

  {# map #}
  {# <script src="/media/js/editor/map.js" type="text/javascript" charset="utf-8"></script> #}
  {# <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&language=en"></script> #}
{% endblock %}

{% block page_title %}Deal details{% endblock %}
{% block title %}Deal details{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
  <li><a href="/">Home</a> <span class="divider">|</span></li>
  <li><a href="/get-the-detail/">Get the detail</a> <span class="divider">|</span></li>
  <li>Deal details</li>
</ul>
{% endblock %}

{% block content %}

  {% if deal %}

    <h5>Activity</h5>

    <div class="bs-example">
      <div class="panel-group" id="accordion">

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">Spatial Data</a>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse in">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Location</h3></td></tr>
                <tr><td>Level of accuracy:</td>                                     <td>{{deal.attributes.level_of_accuracy}}</td></tr>
                <tr>
                    <td>Location:</td>
                    <td>
                        {{deal.attributes.location}}
                        <div class="map" style="width:470px; height:400px; margin-bottom: 30px;"></div>
                    </td>
                </tr>
                <tr><td>Latitude:</td>                                              <td>{{deal.attributes.point_lat}}</td></tr>
                <tr><td>Longitude:</td>                                             <td>{{deal.attributes.point_lon}}</td></tr>
                <tr><td>Target country:</td>                                        <td>{{deal.attributes.target_country}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">General Information</a>
            </h4>
          </div>
          <div id="collapseTwo" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Land Area</h3></td></tr>
                <tr><td>Intended size:</td>                                         <td>{{deal.attributes.intended_size}}</td></tr>
                <tr><td>Current size under contract (leased or purchased area):</td><td>{{deal.attributes.xxxx}}</td></tr>
                <tr><td>Current size in operation (production):</td>                <td>{{deal.attributes.xxxx}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Intention of investment</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.intention}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Nature of the deal</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.nature}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Negotiation status</h3></td></tr>
                <tr>
                    <td></td>
                    <td>
                        {% if deal.attributes.negotiation_status %}{{deal.attributes.negotiation_status}}
                        {% elif deal.attributes.pi_negotiation_status %}{{deal.attributes.pi_negotiation_status}}
                        {% endif %}
                    </td>
                </tr>
                <tr><td>Contract number:</td>                                       <td>{{deal.attributes.contract_number}}</td></tr>
                <tr><td>Contract date:</td>                                         <td>{{deal.attributes.contract_date}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Duration of the agreement</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Implementation status</h3></td></tr>
                <tr>
                    <td></td>
                    <td>
                        {% if deal.attributes.implementation_status %}{{deal.attributes.implementation_status}}
                        {% elif deal.attributes.pi_implementation_status %}{{deal.attributes.pi_implementation_status}}
                        {% endif %}
                    </td>
                </tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Purchase Price</h3></td></tr>
                <tr><td>Purchase price:</td>                                        <td>{{deal.attributes.purchase_price}}</td></tr>
                <tr><td>Purchase price currency:</td>                               <td>{{deal.attributes.purchase_price_currency}}</td></tr>
                <tr><td>Purchase price area type:</td>                              <td>{{deal.attributes.purchase_price_area}}</td></tr>
                <tr><td>Purchase price area type:</td>                              <td>{{deal.attributes.purchase_price_type}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Leasing fees</h3></td></tr>
                <tr><td>Annual leasing fee:</td>                                    <td>{{deal.attributes.annual_leasing_fee}}</td></tr>
                <tr><td>Annual leasing fee currency:</td>                           <td>{{deal.attributes.annual_leasing_fee_currency}}</td></tr>
                <tr><td>Annual leasing fee area:</td>                               <td>{{deal.attributes.annual_leasing_fee_area}}</td></tr>
                <tr><td>Annual leasing fee type:</td>                               <td>{{deal.attributes.annual_leasing_fee_type}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Contract farming</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.contract_farming}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">Employment</a>
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Number of total jobs created</h3></td></tr>
                <tr><td>Jobs created (total):</td>                                  <td>{{deal.attributes.total_jobs_created}}</td></tr>
                <tr><td>Planned number of jobs (total):</td>                        <td>{{deal.attributes.total_jobs_planned}}</td></tr>
                <tr><td>Planned employees (total):</td>                             <td>{{deal.attributes.total_jobs_planned_employees}}</td></tr>
                <tr><td>Planned daily/seasonal workers (total):</td>                <td>{{deal.attributes.total_jobs_planned_daily_workers}}</td></tr>
                <tr><td>Current number of jobs (total):</td>                        <td>{{deal.attributes.total_jobs_current}}</td></tr>
                <tr><td>Current number of employees (total):</td>                   <td>{{deal.attributes.total_jobs_current_employees}}</td></tr>
                <tr><td>Current number of daily/seasonal workers (total):</td>      <td>{{deal.attributes.total_jobs_current_daily_workers}}</td></tr>
                <tr><td>Additional comments on jobs created (total):</td>           <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Number of jobs for foreigners created</h3></td></tr>
                <tr><td>Jobs created (foreign):</td>                                <td>{{deal.attributes.foreign_jobs_created}}</td></tr>
                <tr><td>Planned number of jobs (foreign):</td>                      <td>{{deal.attributes.foreign_jobs_planned}}</td></tr>
                <tr><td>Planned employees (foreign):</td>                           <td>{{deal.attributes.foreign_jobs_planned_employees}}</td></tr>
                <tr><td>Planned daily/seasonal workers (foreign):</td>              <td>{{deal.attributes.foreign_jobs_planned_daily_workers}}</td></tr>
                <tr><td>Current number of jobs (foreign):</td>                      <td>{{deal.attributes.foreign_jobs_current}}</td></tr>
                <tr><td>Current number of employees (foreign):</td>                 <td>{{deal.attributes.foreign_jobs_current_employees}}</td></tr>
                <tr><td>Current number of daily/seasonal workers (foreign):</td>    <td>{{deal.attributes.foreign_jobs_current_daily_workers}}</td></tr>
                <tr><td>Additional comments on jobs created (foreign):</td>         <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Number of domestic jobs created</h3></td></tr>
                <tr><td>Jobs created (domestic):</td>                               <td>{{deal.attributes.domestic_jobs_created}}</td></tr>
                <tr><td>Planned number of jobs (domestic):</td>                     <td>{{deal.attributes.domestic_jobs_planned}}</td></tr>
                <tr><td>Planned employees (domestic):</td>                          <td>{{deal.attributes.domestic_jobs_planned_employees}}</td></tr>
                <tr><td>Planned daily/seasonal workers (domestic):</td>             <td>{{deal.attributes.domestic_jobs_planned_daily_workers}}</td></tr>
                <tr><td>Current number of jobs (domestic):</td>                     <td>{{deal.attributes.domestic_jobs_current}}</td></tr>
                <tr><td>Current number of employees (domestic):</td>                <td>{{deal.attributes.domestic_jobs_current_employees}}</td></tr>
                <tr><td>Current number of daily/seasonal workers (domestic):</td>   <td>{{deal.attributes.domestic_jobs_current_daily_workers}}</td></tr>
                <tr><td>Additional comments on jobs created (domestic):</td>        <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">Investor info</a>
            </h4>
          </div>
          <div id="collapseFour" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td>Name of the investment project:</td>                        <td>{{deal.attributes.xxxx}}</td></tr>
                <tr><td>Primary Investor:</td>                                      <td>{{deal.primary_investor.name}}</td></tr>
                <tr><td>TO DO:</td>                                                 <td>{{deal.attributes.xxxx}}</td></tr>
                <tr><td>Additional comments regarding investors:</td>               <td>{{deal.attributes.xxxx}}</td></tr>

                {% if deal.stakeholder %}
                  <tr><td colspan="2"><h3>Secondary investors</h3></td></tr>
                  <tr>
                      <td>{{deal.stakeholder.investor_name}} ({{deal.stakeholder.country}}{% if deal.stakeholder.classification %}, {{deal.stakeholder.classification}}{% endif %})</td>
                      <td>[percentage]%</td>
                  </tr>
                {% endif %}
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">Data Sources</a>
            </h4>
          </div>
          <div id="collapseFive" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">
                {% for i in deal.attributes.type|length|get_range %}
                  <tr><td colspan="2"><h3>Data Source</h3></td></tr>
                  <tr><td>Data source type:</td>                                    <td>{{deal.attributes.type|lookup:i}}</td></tr>
                  <tr><td>URL:</td>                                                 <td>{{deal.attributes.url|lookup:i}}</td></tr>
                  <tr><td>File:</td>                                                <td>{{deal.attributes.file|lookup:i}}</td></tr>
                  <tr><td>Date:</td>                                                <td>{{deal.attributes.xxxx}}</td></tr>
                  <tr><td>Includes in-country-verified information:</td>            <td>{{deal.attributes.xxxx}}</td></tr>
                  <tr><td>Additional comments:</td>                                 <td>{{deal.attributes.xxxx}}</td></tr>
                {% endfor %}
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseSix">Local Communities</a>
            </h4>
          </div>
          <div id="collapseSix" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>How did community react?</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.community_reaction}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Consultation of local community</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.community_consultation}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Promised or received compensation</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.community_compensation}}</td></tr>

                <tr><td colspan="2"><h3>Benefits for local communities</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.community_benefits}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Number of people actually displaced</h3></td></tr>
                <tr><td>Number of displaced people:</td>                            <td>{{deal.attributes.number_of_displaced_people}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseSeven">Former Use</a>
            </h4>
          </div>
          <div id="collapseSeven" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Former land owner</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.land_owner}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Former land use</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.land_use}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Former land cover</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.land_cover}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseEight">Produce info</a>
            </h4>
          </div>
          <div id="collapseEight" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Detailed crop, animal and mineral information</h3></td></tr>
                <tr><td>Crops:</td>                                                 <td>{{deal.attributes.crops}}</td></tr>
                <tr><td>Animals:</td>                                               <td>{{deal.attributes.animals}}</td></tr>
                <tr><td>Minerals:</td>                                              <td>{{deal.attributes.minerals}}</td></tr>

                <tr><td colspan="2"><h3>Use of produce</h3></td></tr>
                <tr><td>Has domestic use:</td>                                      <td>{{deal.attributes.has_domestic_use}}</td></tr>
                <tr><td>Domestic use:</td>                                          <td>{{deal.attributes.domestic_use}}</td></tr>
                <tr><td>Has export:</td>                                            <td>{{deal.attributes.has_export}}</td></tr>
                <tr><td>Export:</td>                                                <td>{{deal.attributes.export}}</td></tr>
                <tr><td>Country 1:</td>                                             <td>{{deal.attributes.export_country1}}</td></tr>
                <tr><td>Country 1 ratio:</td>                                       <td>{{deal.attributes.export_country1_ratio}}</td></tr>
                <tr><td>Country 2:</td>                                             <td>{{deal.attributes.export_country2}}</td></tr>
                <tr><td>Country 2 ratio:</td>                                       <td>{{deal.attributes.export_country2_ratio}}</td></tr>
                <tr><td>Country 3:</td>                                             <td>{{deal.attributes.export_country3}}</td></tr>
                <tr><td>Country 3 ratio:</td>                                       <td>{{deal.attributes.export_country3_ratio}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>In country processing of produce</h3></td></tr>
                <tr><td>In country processing of produce:</td>                      <td>{{deal.attributes.in_country_processing}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseNine">Water</a>
            </h4>
          </div>
          <div id="collapseNine" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Water extraction envisaged</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.water_extraction_envisaged}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>Source of water extraction</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.source_of_water_extraction}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>How much do investors pay for water and the use of water infrastructure?</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.xxxx}}</td></tr>

                <tr><td colspan="2"><h3>How much water is extracted?</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.water_extraction_amount}}</td></tr>
                <tr><td>Additional comments:</td>                                   <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseTen">Gender-related info</a>
            </h4>
          </div>
          <div id="collapseTen" class="panel-collapse collapse">
            <div class="panel-body">
              <table class="i-dont-know-how-to-do-this-in-css-yes-i-know-booh">

                <tr><td colspan="2"><h3>Any gender-specific information about the investment and its impacts</h3></td></tr>
                <tr><td></td>                                                       <td>{{deal.attributes.xxxx}}</td></tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

  {% else %}

    <p>There are currently no deals matching your search criteria. <a href="/public/">Add a deal</a>.</p>

  {% endif %}

  {% if forms %}

    <table>

      {% for form in forms %}

        <tr><td>

          {% if form.forms %}

            formset: {{ form }}

            {% if form.forms.0.has_investor %}
              <tr><td>Primary investor</td><td>{{ investor.primary_investor }}</td></tr>
              {% for i in investor.secondary_investors %}
                <tr><td>Secondary investor</td><td>{{i.investor_name}} - {{i.country}}</td></tr>
              {% endfor %}

            {% else %} {# form.forms.0.has_investor #}

              {% for form in form.forms %}
                {% for field in form %}
                  {% if field.value and field.label %}
                    {% if "Latitude" in field.label %}
                      <tr style="display:none"><td></td><td><input class="point_lat" type="hidden" value="{{field.value}}"></td></tr>
                    {% elif "Longitude" in field.label %}
                      <tr style="display:none"><td></td><td><input class="point_lon" type="hidden" value="{{field.value}}"></td></tr>
                    {% elif "Location" in field.label %}
                      <tr><td>Location</td><td>{{field|safe}}</td></tr>
                    {% elif "URL" in field.label %}
                      <tr><td style="border-top: none">URL</td><td style="border-top: none">{% for v in field.value|ensure_list %}<a target="_blank" href='{{ v }}'>{{ v|truncatechars:55 }}</a>{% endfor %}</td></tr>
                    {% elif "Date" in field.label %}
                      <tr><td style="border-top: none">Date</td><td style="border-top: none">{{field.value}}</td></tr>
                    {% else %}
                      <tr><td>{{ field.label }}</td><td>{{ field.value|ensure_list|display_values:field.field|join:"<br />" }}</td></tr>
                    {% endif %}
                  {% endif %}
                {% endfor %}
              {% endfor %}

            {% endif %} {# form.forms.0.has_investor #}

          {% else %} {# form.forms #}

              {% for field in form %}

                  {{ field }}

                  {% if field.value and field.label %}
                      <tr><td>{{ field.label }}</td><td>{{ field.value|ensure_list|display_values:field.field|join:"<br />" }}</td></tr>
                  {% endif %}

              {% endfor %}

          {% endif %}  {# form.forms #}

        </td></tr>

      {% endfor %}

    </table>

  {% endif %}

{% endblock %}
