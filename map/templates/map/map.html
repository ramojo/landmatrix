{% extends "base.html" %}
{% load i18n custom_tags sass_tags %}
{% load humanize %}
{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static "vendor/openlayers/ol.css" %}"/>
  <link rel="stylesheet" href="{% static "css/nprogress.css" %}"/>
  <link rel="stylesheet" href="{% static "css/ol3-layerswitcher.css" %}"/>
  <link rel="stylesheet" href="{% static "css/map.css" %}"/>
{% endblock %}

{% block page_title %}{% trans "Map" %}{% endblock %}
{% block title %}{% trans "Map" %}{% endblock %}
{% block breadcrumb_inner %}
  <li><a href="{% url 'data' %}">{% trans "Global" %}</a></li>
  <li>{% trans "Map" %}</li>
{% endblock %}

{% block subnav_inner %}
  <li role="presentation" class="active">
    <span><i class="lm lm-map-marker"></i>{% trans "Map" %}</span></li>
  <li role="presentation"><a href="../data/">
    <i class="lm lm-table"></i>{% trans "Data" %}
  </a></li>
  <li role="presentation"><a href="../charts/">
    <i class="lm lm-bar-chart"></i>{% trans "Charts" %}
  </a></li>
  <li class="divider"></li>
  <li role="presentation">
    {% include "export.html" %}
  </li>
{% endblock %}

{% block content %}

  <link rel="stylesheet" href="{% static "map/css/map.css" %}">
  <div class="map-container">
    <div id="map" class="map" title="{% trans "All Deals" %}">
      <img src="{% static "map/images/map-default.png" %}" alt="{% trans "Map with all deals" %}" id="map-placeholder">
    </div>

    <div class="map-progress row">
      <div class="col-md-3">
        <div class="status">
          <div class="glyphicon glyphicon-picture" aria-hidden="true"></div>
          {% trans "Map" %}
        </div>
        <div class="line right"></div>
      </div>
      <div class="col-md-3">
        <div class="line left"></div>
        <div class="status">
          <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
          {% trans "Countries" %}
        </div>
        <div class="line right"></div>
      </div>
      <div class="col-md-3">
        <div class="line left"></div>
        <div class="status">
          <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span>
          {% trans "Deals" %}
        </div>
        <div class="line right"></div>
      </div>
      <div class="col-md-3">
        <div class="line left"></div>
        <div class="status">
          <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
          {% trans "Finished" %}
        </div>
      </div>
    </div>

    <div class="map-panel">
      <div class="row">
        <div class="col-md-12 tab-container">
          <div class="col-md-4 tab-menu">
            <div class="list-group">
              <a href="#" class="list-group-item active text-center">
                <h4 class="glyphicon glyphicon-cog"></h4><br/>{% trans "Deals" %}
              </a>
              <a href="#" class="list-group-item text-center">
                <h4 class="glyphicon glyphicon-search"></h4><br/>{% trans "Search" %}
              </a>
              <a href="#" class="list-group-item text-center">
                <h4 class="glyphicon glyphicon-filter"></h4><br/>{% trans "Context" %}
              </a>
              <a href="#" class="list-group-item text-center">
                <h4 class="glyphicon glyphicon-road"></h4><br/>{% trans "Base" %}
              </a>
              <a href="#" class="list-group-item text-center">
                <h4 class="glyphicon glyphicon-menu-right"></h4><br/>{% trans "Hide" %}
              </a>
            </div>
          </div>
          <div class="col-md-8 tab">
            <div class="tab-content active">
              <h4><span>{% trans "Deal type" %}</span></h4>
              <select>
                <option selected="selected">{% trans "Intention of investment" %}</option>
              </select>
              <h4><span>{% trans "Legend" %}</span></h4>
            </div>
            <div class="tab-content">
                search
            </div>
            <div class="tab-content">
              context
            </div>
            <div class="tab-content">
                base layer
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script src="https://openlayers.org/en/v4.0.0/build/ol-debug.js" type="text/javascript"></script>
  <script src="{% static "map/js/mapPlugin.js" %}"></script>
  <script>
    $(function () {
      var mapProgress = $(".map-progress");
      var success = "finished";
      var mapPlaceholder = $("#map-placeholder");
      var advanceProgressLine = function() {
        var currentProgressLine = mapProgress.find(".line:not(." + success + "):first");
        currentProgressLine.addClass(success);
      };
      var advanceProgress = function() {
        var currentIcon = mapProgress.find(".status:not(." + success + "):first");
        currentIcon.addClass(success);
        advanceProgressLine();
      };

      // first step: replace static image with map.
      advanceProgress();
      var map = $.setMap({
        deals_url: "{% url "deals_api" %}"
      });
      mapPlaceholder.remove();
      advanceProgressLine();

      // load country-data and cluster deals.
      advanceProgress();
      map.loadCountries();
    });

{#      $(document).ready(function() {#}
{#        $("div.tab-menu>div.list-group>a").click(function(e) {#}
{#            e.preventDefault();#}
{#            $(this).siblings("a.active").removeClass("active");#}
{#            $(this).addClass("active");#}
{#            var index = $(this).index();#}
{#            $("div.tab>div.tab-content").removeClass("active");#}
{#            $("div.tab>div.tab-content").eq(index).addClass("active");#}
{#        });#}
{#      });#}
  </script>
{% endblock %}
