{% load i18n custom_tags static crispy_forms_tags %}
{% load humanize %}

<div id="filters">
    {% csrf_token %}
    <div id="list-filters" class="row">
        <form>
            <div class="col-md-10 clearfix" id="filterlist">
                <label>{% trans "No active filters" %}</label>
            </div>
        </form>
        <div class="col-md-2 text-right">
            <a class="toggle-filters" role="button" data-toggle="collapse" href="#manage-filters" aria-expanded="true"
               data-toggle-text="{% trans "Hide filters" %}"
               aria-controls="manage-filters">
                {% trans "Manage filters" %}
            </a>
            <a href="#" class="toggle-tooltip noul"
               title="You can create custom filters here. Filters are kept when changing entry point.">
                <i class="lm lm-question-circle"> </i></a>
        </div>
    </div>

    <div id="manage-filters" class="clearfix collapse">
        <div id="filterrow" class="row">
            <div class="col-md-3 filterbox presetbox no-pad">
                <h6>{% trans "Select a filter preset" %}</h6>
                <ul class="presets variables">
                    {% for group in presets %}
                        <li>
                            <h4>
                                {{ group.name }}
                                <a href="#" class="toggle-tooltip pull-right" title="{{ group.name }}">
                                    <i class="fa fa-question-circle"> </i>
                                </a>
                            </h4>
                            <ul>
                                {% for preset in group.filter_presets.all %}
                                    <li class="filter_item">
                                        <a href="javascript:loadPreset('{{ preset.id }}', '{{ preset.name }}')"
                                           title="{{ group.name }}: {{ preset.name }}">
                                            {% trans preset.name %}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="col-md-3 filterbox no-pad">
                <h6>{% trans "Create a custom filter" %}</h6>
                <ul class="variables">
                    {% for group in variables %}
                        <li>
                            <h4>{{ group.label }}</h4>
                            <ul>
                                {% for variable in group.items %}
                                    <li id="filter_{{ variable.name }}" class="filter_item"><a
                                            href="javascript:createFilter('{{ variable.name }}', '{{ variable.label }}')"
                                            id="filter_{{ variable.name }}_link">{% trans variable.label %}</a>
                                    </li>
                                {% endfor %}
                            </ul>
                        </li>
                    {% endfor %}
                </ul>

            </div>
            <form class="form" style="display:none">
                <div class="col-md-2 filterbox filtercontrolbox">
                    <h6>&nbsp;</h6>
                    <input id="filter_variable" type="hidden" name="variable" value=""/>
                    <div class="">
                        <select id="filter_operator" name="operator" class="form-control">
                            <option value="lt"><</option>
                            <option value="gt">></option>
                            <option value="gte">>=</option>
                            <option value="lte">=<</option>
                            <option value="is">is</option>
                            <option value="is_empty">is empty</option>
                            <option value="not_in">not in</option>
                            <option value="in">in</option>
                            <option value="contains">contains</option>
                        </select>

                    </div>
                    <button id="filter_submit" type="submit" class="btn btn-primary" name="add"
                            value="add">{% trans "Add Filter" %}</button>
                </div>
                <div class="col-md-4 filtervaluebox filterbox">
                    <h6>&nbsp;</h6>
                    <div class="" id="filter_value"> <!-- class="form-inline"> -->
                        <input type="text" class="form-control"/>
                    </div>
                </div>
            </form>
        </div>
        {% if columns and group == 'all' %}
        <div id="columnsrow" class="row">
            <div class="col-sm-12">
                <h6>{% trans "Select columns for the result table" %}</h6>
                <select id="id_columns" name="columns" multiple="multiple">
                    {% for group in variables %}
                    <optgroup label="{{ group.label }}">
                        {% for variable in group.items %}
                        <option value="{{ variable.name }}"{% if variable.name in columns %} selected="selected"{% endif %}>{% trans variable.label %}</option>
                        {% endfor %}
                    </optgroup>
                    {% endfor %}
                </select>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% block js %}
    <script src="{% static "js/editor/year-based-fields.js" %}" type="text/javascript" charset="utf-8"></script>
    <script src="{% static "js/filters.js" %}" type="text/javascript"></script>
{% endblock %}