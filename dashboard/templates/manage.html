{% extends "base.html" %}
{% load i18n custom_tags %}

{% block breadcrumb_inner %}
<li>{% trans "Manage deals " %}</li>
{% endblock %}

{% block Page_title %}{% trans "Manage deals" %}{% endblock %}
{% block title %}{% trans "Manage deals" %}{% endblock %}

{% block content %}
<script type="text/javascript">
$(document).ready(function () {
    {% if request.GET.selected %}
        $('ul.manage.nav li i.icon-chevron-down').removeClass("icon-white");
        $('ul.manage.nav li a[href="#{{ request.GET.selected }}"]').tab("show").find("i.icon-chevron-down").addClass("icon-white");
    {% else %}
        $('ul.manage.nav li:first-child a').tab("show");
    {% endif %}
});
</script>
<ul class="manage nav nav-tabs" id="manage-sections">
  <li><a href="#feedbacks"><i class="icon-chevron-down icon-white"></i> {% trans "Feedback" %}{% if feedbacks.feeds %} ({{ feedbacks.feeds|length }}){% endif %}</a></li>
  {% if not perms.editor.change_activity %}
  <li><a href="#my-pending-deals"><i class="icon-chevron-down"></i> {% trans "My deals" %}{% if my_deals %} ({{ my_deals.cs|length }}){%  endif %}</a></li>
  {% else %}
  <li><a href="#updates"><i class="icon-chevron-down"></i> {% trans "Pending updates" %}{% if updates %} ({{ updates.cs|length }}){% endif  %}</a></li>
  <li><a href="#deletions"><i class="icon-chevron-down"></i> {% trans "Pending deletions" %}{% if deletes %} ({{ deletes.cs|length }}){% endif %}</a></li >
  <li><a href="#inserts"><i class="icon-chevron-down"></i> {% trans "New deals for approval" %}{% if inserts %} ({{ inserts.cs|length }}){% endif %}</a></ li>
  <li><a href="#sh-deletions"><i class="icon-chevron-down"></i> {% trans "Pending Stakeholder deletions" %}{% if sh_deletes %} ({{ sh_deletes.cs|length }}){% endif %}</a></li>
  {% endif %}
</ul>
<p>&nbsp;</p>
<div class="tab-content">
<div id="feedbacks" class="tab-pane active">
{% if feedbacks.feeds %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="deal">{% trans "Deal #" %}</th>
      <th class="user">{% trans "Request from" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="timestamp">{% trans "Requested" %}</th>
    </thead>
    <tbody>
      {% for feedback in feedbacks.feeds %}
      <tr>
        <td class="deal"><a href="/browse/deal/{{ feedback.deal_id }}/">#{{ feedback.deal_id }}</a></td>
        <td class="user">{{ feedback.from_user }}</td>
        <td class="comment" title="{{ feedback.comment }}">{{ feedback.comment }}</td>
        <td class="date">{{ feedback.timestamp|naturaltime_from_string }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in feedbacks.pagination %}
      <li><a href="{% add_get_parameter feedbacks_page=feedbacks.pagination.previous,selected='feedbacks' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ feedbacks.pagination.current }} {% trans "of" %} {{ feedbacks.pagination.last }}</a>
      </li>
      {% if "next" in feedbacks.pagination %}
      <li><a href="{% add_get_parameter feedbacks_page=feedbacks.pagination.next,selected='feedbacks' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
{% else %}
  <p>{% trans "Currently there are no feedback requests." %}</p>
{% endif %}
</div>
{% if not perms.editor.change_activity %}
<div id="my-pending-deals" class="tab-pane active">
  {% if my_deals %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="deal">{% trans "Deal #" %}</th>
      <th class="user">{% trans "Added" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="status">{% trans "Status" %}</th>
    </thead>
    <tbody>
      {% for changeset in my_deals.cs %}
      <tr>
        <td class="deal">
            {% if changeset.status == "rejected" %}
            <a href="/browse/deal/{{ changeset.deal_id }}/?version=rejected">#{{ changeset.deal_id }} ({% trans   "Rejected version" %})</a>
            {% else %}
            <a href="/browse/deal/{{ changeset.deal_id }}/">#{{ changeset.deal_id }}</a>
            {% endif %}
        </td>
        <td class="user">{{ changeset.timestamp|naturaltime_from_string }}</td>
        <td class="comment" title="{{ changeset.comment }}">{{ changeset.comment }}</td>
        <td class="status" title="{{ changeset.status }}">{{ changeset.status }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in my_deals.pagination %}
      <li><a href="{% add_get_parameter my_deals_page=my_deals.pagination.previous,selected='my_deals' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ my_deals.pagination.current }} {% trans "of" %} {{ my_deals.pagination.last }}</a>
      </li>
      {% if "next" in my_deals.pagination %}
      <li><a href="{% add_get_parameter my_deals_page=my_deals.pagination.next,selected='my_deals' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
  {% else %}
  <p>{% trans "Currently there are no pending updates." %}</p>
  {% endif %}
</div>
{% else %}
<div id="updates" class="tab-pane active">
{% if updates %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="deal">{% trans "Deal #" %}</th>
      <th class="user">{% trans "Last revision" %}</th>
      <th class="modified">{% trans "Modified areas" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="action">{% trans "Actions" %}</th>
    </thead>
    <tbody>
      {% for changeset in updates.cs %}
      <tr>
        <td class="deal"><a href="/browse/deal/{{ changeset.deal_id }}/">#{{ changeset.deal_id }}</a></td>
        <td class="user">{{ changeset.user }}</td>
        <td class="modified">{{ changeset.fields_changed }}</td>
        <td class="comment" title="{{ changeset.comment }}">{{ changeset.comment }}</td>
        <td class="action">
          <a href="/manage/deal/approve/{{ changeset.id }}/" class="btn btn-success approve"><i class="icon-ok"></i> {% trans "Approve" %}</a>
          <a href="/manage/deal/reject/{{ changeset.id }}/" class="btn btn-danger reject"><i class="icon-remove"></i> {% trans "Reject" %}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in updates.pagination %}
      <li><a href="{% add_get_parameter updates_page=updates.pagination.previous,selected='updates' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ updates.pagination.current }} {% trans "of" %} {{ updates.pagination.last }}</a>
      </li>
      {% if "next" in updates.pagination %}
      <li><a href="{% add_get_parameter updates_page=updates.pagination.next,selected='updates' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
{% else %}
  <p>{% trans "Currently there are no pending updates." %}</p>
{% endif %}
</div>
<div id="deletions" class="tab-pane">
{% if deletes %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="deal">{% trans "Deal #" %}</th>
      <th class="user">{% trans "Last revision" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="action">{% trans "Actions" %}</th>
    </thead>
    <tbody>
      {% for changeset in deletes.cs %}
      <tr>
        <td class="deal"><a href="/browse/deal/{{ changeset.deal_id }}/">#{{ changeset.deal_id }}</a></td>
        <td class="user">{{ changeset.user }}</td>
        <td class="comment" title="{{ changeset.comment }}">{{ changeset.comment }}</td>
        <td class="action">
          <a href="/manage/deal/approve/{{ changeset.id }}/" class="btn btn-success approve"><i class="icon-ok"></i> {% trans "Approve" %}</a>
          <a href="/manage/deal/reject/{{ changeset.id }}/" class="btn btn-danger reject"><i class="icon-remove"></i> {% trans "Reject" %}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in deletes.pagination %}
      <li><a href="{% add_get_parameter deletes_page=deletes.pagination.previous,selected='deletions' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ deletes.pagination.current }} {% trans "of" %} {{ deletes.pagination.last }}</a>
      </li>
      {% if "next" in deletes.pagination %}
      <li><a href="{% add_get_parameter deletes_page=deletes.pagination.next,selected='deletions' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
{% else %}
  <p>{% trans "Currently there are no pending deletions." %}</p>
{% endif %}
</div>
<div id="inserts" class="tab-pane">
{% if inserts %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="deal">{% trans "Deal #" %}</th>
      <th class="user">{% trans "Last revision" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="action">{% trans "Actions" %}</th>
    </thead>
    <tbody>
      {% for changeset in inserts.cs %}
      <tr>
        <td class="deal"><a href="/browse/deal/{{ changeset.deal_id }}/">#{{ changeset.deal_id }}</a></td>
        <td class="user">{{ changeset.user }}</td>
        <td class="comment" title="{{ changeset.comment }}">{{ changeset.comment }}</td>
        <td class="action">
          <a href="/manage/deal/approve/{{ changeset.id }}/" class="btn btn-success approve"><i class="icon-ok"></i> {% trans "Approve" %}</a>
          <a href="/manage/deal/reject/{{ changeset.id }}/" class="btn btn-danger reject"><i class="icon-remove"></i> {% trans "Reject" %}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in inserts.pagination %}
      <li><a href="{% add_get_parameter inserts_page=inserts.pagination.previous,selected='inserts' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ inserts.pagination.current }} {% trans "of" %} {{ inserts.pagination.last }}</a>
      </li>
      {% if "next" in inserts.pagination %}
      <li><a href="{% add_get_parameter inserts_page=inserts.pagination.next,selected='inserts' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
{% else %}
  <p>{% trans "Currently there are no new deals for approval." %}</p>
{% endif %}
</div>
<div id="sh-deletions" class="tab-pane">
{% if sh_deletes %}
  <table class="table table-striped table-condensed">
    <thead>
      <th class="Stakeholder">{% trans "Stakeholder #" %}</th>
      <th class="user">{% trans "Last revision" %}</th>
      <th class="comment">{% trans "Comment" %}</th>
      <th class="action">{% trans "Actions" %}</th>
    </thead>
    <tbody>
      {% for changeset in sh_deletes.cs %}
      <tr class="deletes">
        <td class="investor"><a href="/browse/investor/{{ changeset.investor_id }}/">#{{ changeset.investor_id }}</a></td>
        <td class="user">{{ changeset.user }}</td>
        <td class="comment" title="{{ changeset.comment }}">{{ changeset.comment }}</td>
        <td class="action">
          <a href="/manage/investor/approve/{{ changeset.id }}/" class="btn btn-success approve"><i class="icon-ok"></i> {% trans "Approve" %}</a>
          <a href="/manage/investor/reject/{{ changeset.id }}/" class="btn btn-danger reject"><i class="icon-remove"></i> {% trans "Reject" %}</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="pagination">
    <ul>
      {% if "previous" in sh_deletes.pagination %}
      <li><a href="{% add_get_parameter deletes_page=sh_deletes.pagination.previous,selected='deletions' %}">Previous</a></li>
      {% endif %}
      <li class="active">
        <a href="#">{% trans "Page" %} {{ sh_deletes.pagination.current }} {% trans "of" %} {{ sh_deletes.pagination.last }}</a>
      </li>
      {% if "next" in sh_deletes.pagination %}
      <li><a href="{% add_get_parameter deletes_page=sh_deletes.pagination.next,selected='deletions' %}" >Next</a></li>
      {% endif %}
    </ul>
  </div>
{% else %}
  <p>{% trans "Currently there are no pending stakeholder deletions." %}</p>
{% endif %}
</div>
{% endif %}
<script type="text/javascript">
  $(function () {
    $('#manage-sections a').click(function (e) {
      e.preventDefault();
      $('#manage-sections .icon-white').removeClass('icon-white');
      $(this).find("i").addClass('icon-white');
      $(this).tab('show');
    });
  });
</script>
</div>
{% endblock %}
