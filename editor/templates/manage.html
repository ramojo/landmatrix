{% extends "base.html" %}
{% load i18n custom_tags %}

{% block breadcrumb_inner %}
    <li><a href="{% url 'editor' %}">{% trans "Dashboard" %}</a></li>
    <li>{% trans "Manage deals " %}</li>
{% endblock %}

{% block page_title %}{% trans "Manage deals" %}{% endblock %}
{% block title %}{% trans "Manage deals" %}{% endblock %}

{% block subnav %}
    <ul class="subnav nav nav-pills pull-right">
        <li role="presentation"><a href="{% url 'map' %}{% if country %}?country={{ country.slug }}{% else %}{% if region %}{{ region.slug }}{% endif %}{% endif %}">
            <i class="lm lm-map-marker"></i>{% trans "Map" %}
        </a></li>
        <li role="presentation"><a href="{% url 'data' %}{% if country %}?country={{ country.slug }}{% else %}{% if region %}{{ region.slug }}{% endif %}{% endif %}">
            <i class="lm lm-table"></i>{% trans "Data" %}
        </a></li>
        <li role="presentation"><a href="{% url 'chart_transnational_deals' %}{% if country %}?country={{ country.slug }}{% else %}{% if region %}{{ region.slug }}{% endif %}{% endif %}">
            <i class="lm lm-bar-chart"></i>{% trans "Charts" %}
        </a></li>
    </ul>
{% endblock %}

{% block content %}
    <script type="text/javascript">
        $(document).ready(function () {
            {% if request.GET.selected %}
                $('ul.manage.nav li i.icon-chevron-down').removeClass("icon-white");
                $('ul.manage.nav li a[href="#{{ request.GET.selected }}"]').tab("show").find("i.icon-chevron-down").addClass("icon-white");
            {% else %}
                $('ul.manage.nav li:first-child a').tab("show");
            {% endif %}
        });
    </script>
    <div class="navbar navbar-default navbar-subnav" role="navigation">
        <div class="container-fluid">
            <ul class="manage nav navbar-nav" id="manage-sections">
                {% if not perms.landmatrix.change_activity %}
                    <li><a href="#my-pending-deals"><i class="icon-chevron-down"></i>
                        {% trans "My deals" %}{% if my_deals_page %} <small><span class="label label-default">{{ my_deals|length }}</span></small>{% endif %}</a></li>
                {% endif %}
                {% if perms.landmatrix.review_activity %}
                    <li><a href="#feedbacks"><i class="icon-chevron-down icon-white"></i>
                        {% trans "Feedback" %}{% if feedbacks.feeds %} <small><span class="label label-default">{{ feedbacks.feeds|length }}){% endif %}</a></li>
                    <li><a href="#updates"><i class="icon-chevron-down"></i>
                        {% trans "Pending updates" %}{% if updates %} <small><span class="label label-default">{{ updates|length }}</span></small>{% endif %}</a></li>
                    <li><a href="#deletions"><i class="icon-chevron-down"></i>
                        {% trans "Pending deletions" %}{% if deletes %} <small><span class="label label-default">{{ deletes|length }}</span></small>{% endif %}</a></li>
                    <li><a href="#inserts"><i class="icon-chevron-down"></i>
                        {% trans "New deals for approval" %}{% if inserts %} <small><span class="label label-default">{{ inserts|length }}</span></small>{% endif %}</a></li>
                    <li><a href="#sh-deletions"><i class="icon-chevron-down"></i>
                        {% trans "Pending investor deletions" %}{% if sh_deletes %} <small><span class="label label-default">{{ sh_deletes|length }}</span></small>{% endif %}
                    </a></li>
                    <li><a href="#rejected"><i class="icon-chevron-down"></i>
                        {% trans "Rejected by me" %}{% if rejected %} <small><span class="label label-default">{{ rejected|length }}</span></small>{% endif %}
                    </a></li>
                {% endif %}
            </ul>
        </div>
    </div>
    <p>&nbsp;</p>
    <div class="tab-content">
        <div id="feedbacks" class="tab-pane active">
            {% if feedbacks.feeds %}
                <table class="table table-striped table-condensed">
                    <colgroup>
                        <col width="10%">
                        <col width="10%">
                        <col width="55%">
                        <col width="25%">
                    </colgroup>
                    <thead>
                    <th class="deal">{% trans "Deal #" %}</th>
                    <th class="user">{% trans "Request from" %}</th>
                    <th class="comment">{% trans "Comment" %}</th>
                    <th class="timestamp">{% trans "Requested" %}</th>
                    </thead>
                    <tbody>
                    {% for feedback in feedbacks.feeds %}
                        <tr>
                            <td class="deal"><a href="{% url 'deal_detail' deal_id=feedback_deal_id %}">#{{ feedback.deal_id }}</a></td>
                            <td class="user">{{ feedback.from_user }}</td>
                            <td class="comment" title="{{ feedback.comment }}">{{ feedback.comment }}</td>
                            <td class="date">{{ feedback.timestamp|naturaltime_from_string }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                <!-- ul class="pagination">
                    {% if "previous" in feedbacks.pagination %}
                        <li><a class="btn btn-default" type="button"
                               href="{% add_get_parameter feedbacks_page=feedbacks.pagination.previous,selected='feedbacks' %}">&laquo;</a>
                        </li>
                    {% endif %}
                    <li class="active">
                        <a class="btn btn-default disabled" href="#">{% trans "Page" %} {{ feedbacks.pagination.current }} {% trans "of" %} {{ feedbacks.pagination.last }}</a>
                    </li>
                    {% if "next" in feedbacks.pagination %}
                        <li><a class="btn btn-default" type="button"
                               href="{% add_get_parameter feedbacks_page=feedbacks.pagination.next,selected='feedbacks' %}">&raquo;</a>
                        </li>
                    {% endif %}
                </ul !-->
            {% else %}
                <p class="alert bg-info">{% trans "Currently there are no feedback requests." %}</p>
            {% endif %}
        </div>
            <div id="my-pending-deals" class="tab-pane active">
                {% if my_deals %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="deal">{% trans "Deal #" %}</th>
                        <th class="user">{% trans "Added" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="status">{% trans "Status" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in my_deals.cs %}
                            <tr>
                                <td class="deal">
                                    {% if activity.status == "rejected" %}
                                        <a href="{% url 'deal_detail' deal_id=activity.deal_id version='rejected' %}">#{{ activity.deal_id }}
                                            ({% trans "Rejected version" %})</a>
                                    {% else %}
                                        <a href="{% url 'deal_detail' deal_id=activity.deal_id %}">#{{ activity.deal_id }}</a>
                                    {% endif %}
                                </td>
                                <td class="user">{{ activity.timestamp|naturaltime_from_string }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="status" title="{{ activity.status }}">{{ activity.status }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!-- ul class="pagination">
                        {% if "previous" in my_deals.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter my_deals_page=my_deals.pagination.previous,selected='my_deals' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a class="btn disabled" href="#">{% trans "Page" %} {{ my_deals.pagination.current }} {% trans "of" %} {{ my_deals.pagination.last }}</a>
                        </li>
                        {% if "next" in my_deals.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter my_deals_page=my_deals.pagination.next,selected='my_deals' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul -->
                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no pending updates." %}</p>
                {% endif %}
            </div>
            <div id="updates" class="tab-pane active">
                {% if updates %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="deal">{% trans "Deal #" %}</th>
                        <th class="user">{% trans "Last revision" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="action">{% trans "Actions" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in updates %}
                            <tr>
                                <td class="deal"><a href="{% url 'deal_detail' deal_id=activity.deal_id %}">#{{ activity.deal_id }}</a>
                                </td>
                                <td class="user">{{ activity.user }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="action">
                                    <a href="{% url 'manage_deal' type='deal' action='approve' id=activity.id %}"
                                       class="label label-default approve"><i
                                            class="lm lm-thumbs-up"></i> {% trans "Approve" %}</a>
                                    <a href="{% url 'manage_deal' type='deal' action='reject' id=activity.id %}"
                                       class="label label-default reject"><i
                                            class="lm lm-thumbs-down"></i> {% trans "Reject" %}</a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!-- ul class="pagination">
                        {% if "previous" in updates.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter updates_page=updates.pagination.previous,selected='updates' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a class="btn disabled" href="#">{% trans "Page" %} {{ updates.pagination.current }} {% trans "of" %} {{ updates.pagination.last }}</a>
                        </li>
                        {% if "next" in updates.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter updates_page=updates.pagination.next,selected='updates' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul -->
                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no pending updates." %}</p>
                {% endif %}
            </div>
            <div id="deletions" class="tab-pane">
                {% if deletes %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="deal">{% trans "Deal #" %}</th>
                        <th class="user">{% trans "Last revision" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="action">{% trans "Actions" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in deletes %}
                            <tr>
                                <td class="deal"><a href="{% url 'deal_detail' deal_id=activity.deal_id %}">#{{ activity.deal_id }}</a>
                                </td>
                                <td class="user">{{ activity.user }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="action">
                                    <a href="{% url 'manage_deal' type='deal' action='approve' id=activity.id %}"
                                       class="label label-default approve"><i class="lm lm-thumbs-up"></i> {% trans "Approve" %}</a>
                                    <a href="{% url 'manage_deal' type='deal' action='reject' id=activity.id %}"
                                       class="label label-default reject"><i class="lm lm-thumbs-down"></i> {% trans "Reject" %}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!-- ul class="pagination">
                        {% if "previous" in deletes.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter deletes_page=deletes.pagination.previous,selected='deletions' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a class="btn btn-default disabled" href="#">{% trans "Page" %} {{ deletes.pagination.current }} {% trans "of" %} {{ deletes.pagination.last }}</a>
                        </li>
                        {% if "next" in deletes.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter deletes_page=deletes.pagination.next,selected='deletions' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul -->
                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no pending deletions." %}</p>
                {% endif %}
            </div>
            <div id="inserts" class="tab-pane">
                {% if inserts %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="deal">{% trans "Deal #" %}</th>
                        <th class="user">{% trans "Last revision" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="action">{% trans "Actions" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in inserts %}
                            <tr>
                                <td class="deal"><a href="{% url 'deal_detail' deal_id=activity.deal_id %}">#{{ activity.deal_id }}</a>
                                </td>
                                <td class="user">{{ activity.user }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="action">
                                    <a href="{% url 'manage_deal' type='deal' action='approve' id=activity.id %}"
                                       class="label label-default approve"><i class="lm lm-thumbs-up"></i> {% trans "Approve" %}</a>
                                    <a href="{% url 'manage_deal' type='deal' action='reject' id=activity.id %}"
                                       class="label label-default reject"><i class="lm lm-thumbs-down"></i> {% trans "Reject" %}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!--ul class="pagination">
                        {% if "previous" in inserts.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter inserts_page=inserts.pagination.previous,selected='inserts' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a class="btn btn-default disabled" href="#">{% trans "Page" %} {{ inserts.pagination.current }} {% trans "of" %} {{ inserts.pagination.last }}</a>
                        </li>
                        {% if "next" in inserts.pagination %}
                            <li><a class="btn btn-default" type="button"
                                   href="{% add_get_parameter inserts_page=inserts.pagination.next,selected='inserts' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul-->
                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no new deals for approval." %}</p>
                {% endif %}
            </div>
            <div id="sh-deletions" class="tab-pane">
                {% if sh_deletes %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="Stakeholder">{% trans "Investor #" %}</th>
                        <th class="user">{% trans "Last revision" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="action">{% trans "Actions" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in sh_deletes %}
                            <tr class="deletes">
                                <td class="investor"><a
                                        href="{% url 'stakeholder_form' investor_id=activity.investor_id %}">#{{ activity.investor_id }}</a>
                                </td>
                                <td class="user">{{ activity.user }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="action">
                                    <a href="{% url 'manage_deal' type='investor' action='approve' id=activity.id %}"
                                       class="label label-default approve"><i class="lm lm-thumbs-up"></i> {% trans "Approve" %}</a>
                                    <a href="{% url 'manage_deal' type='investor' action='reject' id=activity.id %}"
                                       class="label label-default reject"><i class="lm lm-thumbs-down"></i> {% trans "Reject" %}
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!-- ul class="pagination">
                        {% if "previous" in sh_deletes.pagination %}
                            <li><a type="button" class="btn btn-default"
                                   href="{% add_get_parameter deletes_page=sh_deletes.pagination.previous,selected='deletions' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a type="button" class="btn btn-default"
                               href="#">{% trans "Page" %} {{ sh_deletes.pagination.current }} {% trans "of" %} {{ sh_deletes.pagination.last }}</a>
                        </li>
                        {% if "next" in sh_deletes.pagination %}
                            <li><a type="button" class="btn btn-default"
                                   href="{% add_get_parameter deletes_page=sh_deletes.pagination.next,selected='deletions' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul -->

                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no pending investor deletions." %}</p>
                {% endif %}
            </div>
            <div id="rejected" class="tab-pane">
                {% if rejected %}
                    <table class="table table-striped table-condensed">
                        <colgroup>
                            <col width="10%">
                            <col width="10%">
                            <col width="55%">
                            <col width="25%">
                        </colgroup>
                        <thead>
                        <th class="dealid">{% trans "Deal ID #" %}</th>
                        <th class="user">{% trans "User" %}</th>
                        <th class="comment">{% trans "Comment" %}</th>
                        <th class="action">{% trans "Timestamp" %}</th>
                        </thead>
                        <tbody>
                        {% for activity in rejected %}
                            <tr class="deletes">
                                <td class="dealid"><a
                                        href="{% url 'deal_detail' deal_id=activity.deal_id history_id=activity.history_id %}">#{{ activity.deal_id }}</a>
                                </td>
                                <td class="user">{{ activity.user }}</td>
                                <td class="comment" title="{{ activity.comment }}">{{ activity.comment }}</td>
                                <td class="timestamp">{{ activity.timestamp }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <!-- ul class="pagination">
                        {% if "previous" in rejected.pagination %}
                            <li><a type="button" class="btn btn-default"
                                   href="{% add_get_parameter deletes_page=sh_deletes.pagination.previous,selected='deletions' %}">&laquo;</a>
                            </li>
                        {% endif %}
                        <li class="active">
                            <a type="button" class="btn btn-default"
                               href="#">{% trans "Page" %} {{ rejected.pagination.current }} {% trans "of" %} {{ rejected.pagination.last }}</a>
                        </li>
                        {% if "next" in rejected.pagination %}
                            <li><a type="button" class="btn btn-default"
                                   href="{% add_get_parameter deletes_page=rejected.pagination.next,selected='deletions' %}">&raquo;</a>
                            </li>
                        {% endif %}
                    </ul -->

                {% else %}
                    <p class="alert bg-info">{% trans "Currently there are no rejected changes." %}</p>
                {% endif %}
            </div>
        <script type="text/javascript">
            $(function () {
                $('#manage-sections a').click(function (e) {
                    e.preventDefault();
                    $('#manage-sections .icon-white').removeClass('icon-white');
                    $(this).find("i").addClass('icon-white');
                    $(this).tab('show');
                });
            });
        </script>
    </div>
{% endblock %}
