{% extends "base.html" %}
{% load i18n %}

{% block page_title %}{% trans "Chart" %}{% endblock %}
{% block title %}{% trans "Chart" %}{% endblock %}

{% block breadcrumb_inner %}
<li><a href="/global/">Global</a></li>
<li><a href="/global/chart">Charts</a></li>
{% endblock %}

{% block subnav_inner %}
    <li role="presentation"><a href="../map/">
        <i class="lm lm-map-marker"></i>{% trans "Map" %}
    </a></li>
    <li role="presentation"><a href="../data/">
        <i class="lm lm-table"></i>{% trans "Data" %}
    </a></li>
    <li role="presentation" class="active"><span>
        <i class="lm lm-bar-chart"></i>{% trans "Charts" %}
    </span></li>
    <li class="divider"></li>
{% endblock %}

{% block content %}
{% block before %}
{% endblock %}
{% include "charts/subnav.html" %}
{% include "filters.html" %}

<div class="row">
    <div class="col-md-6">
        <div class="well">
            {% block description %}{{ body|safe }}{% endblock %}
        </div>
    </div>
    <div class="col-md-6">
        <div class="well">
            {% block legend %}
            <ul class="media-list legend offset">
                <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span> {% trans "Food-Crop - Crops that be consumed by humans, even if also used as livestock feed" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #225559;"></i><span> {% trans "Non-Food - Biofuels, exclusive livestock feed, industrial, cosmetic and medicinal uses" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span> {% trans "Flex-Crop - Potential both biofuel and food uses" %}</span></li>
                <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span> {% trans "Multiple Use - Several crops in different categories" %}</span></li>
            </ul>
            {% endblock %}
        </div>
    </div>
</div>

{% block data %}
{% endblock %}

{% block after %}
<script type="text/javascript">
function get_base_filter() {
    var filters = "";
    // negotiation status (concluded, intended, failed)
    $('.filters .negotiation_status:visible .btn.active').each(function() {
        filters += "&negotiation_status=" + $(this).val();
    });
	// deal scope (transnational, domestic)
    $('.filters .deal_scope .btn.active').each(function() {
        filters += "&deal_scope=" + $(this).val();
    });
	// data source (boolean)
    $('.filters .data_source_type .btn.active').each(function() {
        filters += "&data_source_type=1";
    });
    return filters.substr(1);
}
function get_query_params(base_filter, filter) {
    if (base_filter && filter) {
        return "?" + base_filter + "&" + filter;
    } else if (base_filter) {
        return "?" + base_filter;
    } else if (filter) {
        return "?" + filter;
    }
    return "";
}
function get_filter() {
    var filter = "";
    var element = $(".actions .action2 .btn.active");
    if (element.length != 0) {
        var params = getParameterByName($(element).attr("href").replace("?", ""));
        var filter = "";
        if (params["filter"] != undefined) {
            filter = "filter=" + params["filter"];
        }
    }
    return filter;
}

//draw();

$(document).ready(function () {

    $(".filters .btn").click(function (e) {
        var c_self = $(this);
        // only combine concluded and intended
        if (c_self.parent().is(".negotiation_status")) {
            if (c_self.val() == "failed") {
                c_self.parent().find(".btn[value=concluded],.btn[value=intended]").removeClass("active");
            } else {
                c_self.parent().find(".btn[value=failed]").removeClass("active");
            }
        }
        c_self.toggleClass("active");
        draw(function() {
            c_self.button('reset');
        });
        e.preventDefault();
    });

    $(".actions .action2 .btn.active").click();
});
</script>
{% endblock %}
{% endblock %}
