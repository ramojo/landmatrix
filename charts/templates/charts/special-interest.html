{% extends "charts/base_chart.html" %}{% load i18n static wagtailcore_tags %}

{% block page_title %}{% trans "Dynamics Overview" %}{% endblock %}
{% block title %}{% trans "Dynamics Overview" %}{% endblock %}
{% block breadcrumb_inner %}
{{ block.super }}
<li>{% trans "Dynamics Overview" %}</li>
{% endblock %}

{% comment %}
get the filters that are active with {{ filters }}
the filter formset/widget is in {{ empty_form_conditions }}
or {% include "filters.html" %}, if the downloads are removed from filters.html
{% endcomment %}

{% block before %}
{% endblock %}

{% block description %}
<div class="desc">

    <p class="agricultural_drivers">{%  trans 'This is the short info about agricultural drivers' %}<a href="{% slugurl 'agricultural-drivers' %}"><i class="lm lm-question-circle"> </i></a></p>
    <p class="resource_extraction" style="display: none">{%trans 'Deals divided by implementation status. Since this chart shows all deals in the database, there is no option to select concluded, intended or failed deals separately.' %} <a href="{% slugurl 'about' %}#how-does-the-global-observatory-deal-with-different-stages-of-negotiation-and-implementation" class="toggle-tooltip left noul" title="{% trans 'The LM has two key variables to describe the status of a land deal: the negotiation status and the implementation status. For further information press the question mark.' %}"><i class="lm lm-question-circle"> </i></a></p>
    <p class="produce_info" style="display: none">{% trans 'Deals divided by intention of investment.' %}</p>
    <p class="contract_farming" style="display: none">{% trans 'Deals having „agriculture“ as main intention of investment disaggregated into sub-sections.' %}</p>

    <span id="deal_data_selector">
        Show infos about:
        <input type="checkbox" name="use_deal_size" checked> of
        <select name="deal_types">
            <option>Concluded</option>
            <option>Contract</option>
            <option>Under Construction</option>
        </select>
    </span>

</div>
{% endblock %}

{% block legend %}
    <ul class="media-list legend offset agricultural">
        <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span> {% trans "Food-Crops" %}</span></li>
        <li><i class="icon icon-none" style="background-color: #225559;"></i><span> {% trans "Non-Food Crops" %}</span></li>
        <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span> {% trans "Flex-Crops" %}</span></li>
        <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span> {% trans "Multiple Use - Several crops in different categories" %}</span></li>
    </ul>
{% endblock %}

{% block data %}
<div class="row">
    <div class="col-md-12">
        <div id="agricultural_drivers" class="row data charts">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-12">
                        <h2>All Continents <span>(0 ha)</span></h2>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        <canvas id="pie-overall" width="420" height="420"></canvas>
                    </div>
                    <div class="col-md-4">
                        <ul class="media-list legend">
                            <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                    class="food-crop"></span></li>
                            <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                    class="non-food-crop"></span></li>
                            <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                    class="flex-crop"></span></li>
                            <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                    class="multiple-crop"></span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h2>Africa <span>(0 ha)</span></h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <canvas id="pie-africa" width="92" height="92"></canvas>
                            </div>
                            <div class="col-md-7">
                                <ul class="media-list legend">
                                    <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                            class="food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                            class="non-food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                            class="flex-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                            class="multiple-crop"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h2>Europe <span>(0 ha)</span></h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <canvas id="pie-europe" width="92" height="92"></canvas>
                            </div>
                            <div class="col-md-7">
                                <ul class="media-list legend">
                                    <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                            class="food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                            class="non-food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                            class="flex-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                            class="multiple-crop"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h2>America <span>(0 ha)</span></h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <canvas id="pie-america" width="92" height="92"></canvas>
                            </div>
                            <div class="col-md-7">
                                <ul class="media-list legend">
                                    <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                            class="food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                            class="non-food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                            class="flex-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                            class="multiple-crop"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h2>Oceania <span>(0 ha)</span></h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <canvas id="pie-oceania" width="92" height="92"></canvas>
                            </div>
                            <div class="col-md-7">
                                <ul class="media-list legend">
                                    <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                            class="food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                            class="non-food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                            class="flex-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                            class="multiple-crop"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-md-12">
                                <h2>Asia <span>(0 ha)</span></h2>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-5">
                                <canvas id="pie-asia" width="92" height="92"></canvas>
                            </div>
                            <div class="col-md-7">
                                <ul class="media-list legend">
                                    <li><i class="icon icon-none" style="background-color: #060c0f;"></i><span
                                            class="food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #225559;"></i><span
                                            class="non-food-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #46b2bf;"></i><span
                                            class="flex-crop"></span></li>
                                    <li><i class="icon icon-none" style="background-color: #acd4dc;"></i><span
                                            class="multiple-crop"></span></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div id="TreeChart" class="charts" align="center">
        </div>

        <svg id="AreaChart" class="charts" align="center" width="400" height="400">
        </svg>

        <div id="PieChart" class="charts" align="center">
        </div>

        <div id="DotChart" class="charts" align="center">
        </div>

        <div id="BarChart" class="charts" align="center">
        </div>


    </div>
</div>
{% endblock %}

{% block after %}
{{ block.super }}
<script type="text/javascript" src="{% static "js/charts.js" %}"></script>
<script type="text/javascript" src="{% static "vendor/d3-areachart/rectangularAreaChart.js" %}"></script>
<script type="text/javascript" src="{% static "legacy/vendor/RGraph.pie.js" %}"></script>
<script type="text/javascript" src="{% static "legacy/vendor/RGraph.common.core.js" %}"></script>
<script type="text/javascript" src="{% static "legacy/vendor/RGraph.common.effects.js" %}"></script>
<script type="text/javascript" src="{% static "legacy/vendor/RGraph.common.dynamic.js" %}"></script>
<script type="text/javascript" src="{% static "legacy/vendor/RGraph.common.tooltips.js" %}"></script>

<script type="text/javascript">
$(document).ready(function () {
    console.log("Query params:", get_query_params(get_base_filter(), ""));

    var dataSwitch = $("[name='use_deal_size']");
    dataSwitch.bootstrapSwitch({
        onText: 'Size',
        offText: 'Count',
        offColor: 'info',
        onSwitchChange: function(event, state) {
            console.log('Deal size/count change triggered:', state);
            if (state) {
                datatype = 'size';
            } else {
                datatype = 'count;'
            }
        }
    });

    $("[name='deal_types']").select2({
        multiple: true,
        width: "20vw"
    });

    $("a.change-special_variable").click(function (e) {
        e.preventDefault();
        var c_self = this;
        $(".navbar-subnav .active").removeClass("active");
        $(".navbar-subnav a[href='" + $(this).attr("href") + "']").parents("li").addClass("active");
        //($(".navbar-subnav .active a").attr("href").indexOf("intention") > -1 && $(".negotiation_status").show() || $(".negotiation_status").hide());
        $(".desc p").hide().filter("." + $(this).attr("href").replace(/.*\?variable=/, "")).show();
        draw($(this).attr("href").replace(/.*\?variable=/, ""));
        return false;
    });
    $("a.change-special_variable:first").click();
    $(".views .btn").click(function (e) {
        e.preventDefault();
        var c_self = this;
        $(".views .active").removeClass("active");
        $(c_self).addClass("active");
        draw();
        return false;
    });
    $(".views .btn.active").click();
});

var storage = {};
function draw (charttype) {
    console.log("About to draw:", charttype);
    $(".charts").each(function() {
        $(this).hide();
        console.log($(this));
        if ($(this)[0].id !== 'agricultural_drivers') {
            $(this).empty();
        }
    });

    $("#deal_data_selector").show();

    if (charttype == "resource_extraction") {
        $("#AreaChart").show();
        buildAreaChart();
    } else if (charttype == "produce_info") {
        $("#TreeChart").show();
        buildTreeChart();
    } else if (charttype == "contract_farming") {
        $("#PieChart").show();
        $("#DotChart").show();

        buildPieChart();
        buildDotChart();
        $("[name='use_deal_size']").bootstrapSwitch('state', false, true);
        $("#deal_data_selector").hide();

    } else if (charttype == "agricultural_drivers") {
        $("#agricultural_drivers").show();
        buildAgriculturalPies();
    }
}
</script>
{% endblock %}
